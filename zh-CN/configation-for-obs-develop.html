<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>桌面版OBS开发配置 | 小径分岔的花园</title>
    <meta name="description" content="比坑更坑">
    
    
    <link rel="preload" href="/assets/css/0.styles.7b2134bf.css" as="style"><link rel="preload" href="/assets/js/app.cea302cc.js" as="script"><link rel="preload" href="/assets/js/3.19db34b2.js" as="script"><link rel="preload" href="/assets/js/1.4d56c206.js" as="script"><link rel="preload" href="/assets/js/14.618c3df5.js" as="script"><link rel="prefetch" href="/assets/js/10.98dc1e52.js"><link rel="prefetch" href="/assets/js/11.7fb4689e.js"><link rel="prefetch" href="/assets/js/12.2ed3259e.js"><link rel="prefetch" href="/assets/js/13.2a95825c.js"><link rel="prefetch" href="/assets/js/15.4fcf900b.js"><link rel="prefetch" href="/assets/js/16.c92ef2b0.js"><link rel="prefetch" href="/assets/js/17.13be32c3.js"><link rel="prefetch" href="/assets/js/18.a189bad8.js"><link rel="prefetch" href="/assets/js/19.52cdb21f.js"><link rel="prefetch" href="/assets/js/20.5a25b9c0.js"><link rel="prefetch" href="/assets/js/21.35a53d71.js"><link rel="prefetch" href="/assets/js/22.990baba6.js"><link rel="prefetch" href="/assets/js/4.b95b1c30.js"><link rel="prefetch" href="/assets/js/5.77231472.js"><link rel="prefetch" href="/assets/js/6.e7dd61c7.js"><link rel="prefetch" href="/assets/js/7.3374042c.js"><link rel="prefetch" href="/assets/js/8.a1dda5c9.js"><link rel="prefetch" href="/assets/js/9.db049bb0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7b2134bf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh-CN/" class="home-link router-link-active"><!----> <span class="site-name">小径分岔的花园</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh-CN/configation-for-obs-develop.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">en</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh-CN/configation-for-obs-develop.html" class="nav-link router-link-exact-active router-link-active">zh-CN</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">en</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>桌面版OBS开发配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh-CN/configation-for-obs-develop.html#macos-版本mojave10-14-6" class="sidebar-link">macOS(版本Mojave10.14.6)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh-CN/configation-for-obs-develop.html#开发环境配置" class="sidebar-link">开发环境配置</a></li><li class="sidebar-sub-header"><a href="/zh-CN/configation-for-obs-develop.html#打包发布步骤" class="sidebar-link">打包发布步骤</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>目前的友商的直播客户端也大多基于OBS开发而来。在此总结下OBS开发环境的搭建与打包发布的流程。</p> <h2 id="macos-版本mojave10-14-6"><a href="#macos-版本mojave10-14-6" class="header-anchor">#</a> macOS(版本Mojave10.14.6)</h2> <p><em>开发后期系统升级到了10.15, 不过并无大碍。</em></p> <h3 id="开发环境配置"><a href="#开发环境配置" class="header-anchor">#</a> 开发环境配置</h3> <p>开发IDE用的是Clion，先下载着。之后会是30天试用，没钱的话网上随便可以破解。
OBS是基于Qt开发的界面，需要安装以下依赖</p> <div class="language- extra-class"><pre class="language-text"><code>brew install FFmpeg x264 qt cmake mbedtls
</code></pre></div><p><strong>注意安装qt最新版</strong>，坑有 Mojave10.14.6 最低也需要 qt 10.12.0 不然样式会有问题；从 5.13.0 到 5.13.1 解决了一个轻触不能触发点击事件且样式错误的bug。</p> <p>在qt安装完成后，应该可以看到引用路径，如 /usr/local/Cellar/qt/5.13.1/</p> <p>在途中也需要clone下官方repo：</p> <div class="language- extra-class"><pre class="language-text"><code>$ git clone --recursive https://github.com/obsproject/obs-studio.git
</code></pre></div><p>注意！一定要使用 --recursive 以克隆子模块，不然无法成功运行。</p> <p>打开 clion，进行以下配置：</p> <ol><li>系统栏 Clion-&gt;Preferences-&gt;Build, Execution, Deployment-&gt;CMake</li> <li>在Debug-&gt;CMake options 中输入</li></ol> <div class="language- extra-class"><pre class="language-text"><code>-DCMAKE_PREFIX_PATH=/usr/local/Cellar/qt/5.13.1/ -DCMAKE_INSTALL_PREFIX=&quot;/Users/yourname/Develop/obs-test/build-debug&quot;
</code></pre></div><ol start="3"><li>执行一遍cmake(界面左下方，CMake标签页左边的run按钮)如果可以正常执行则界面左上会出现 &quot;CMake Application&quot; 的列表，如果该列表中没有ALL_BUILD选项，则需要在 &quot;Edit configration&quot; 中手工创建一个。</li> <li>点击创建的ALL_BUILD，点击左边的锤子按钮执行一遍build。</li> <li>&quot;Edit configration&quot; 中选中obs，在build列表下方新建一项 &quot;Run External tool&quot;, 添加一项，Name 与 Pragram 填 make，Arguments填install, Working directory 填 /Users/yourname/Develop/obs-test/cmake-build-debug, 点击 ok 后添加。</li> <li>&quot;CMake Application&quot; 中选择 obs 点击列表框右边的 run，执行过一遍 make 之后会提示没有找到执行文件，这时再点开 obs 的 Edit configration, 在 Executable 中选择 build-debug/bin/obs</li> <li>再次运行，之后便可以打开 obs 界面，进行开发了。</li></ol> <h3 id="打包发布步骤"><a href="#打包发布步骤" class="header-anchor">#</a> 打包发布步骤</h3> <p>在开发初期时按照官方尝试过直接在 cmake-build-debug 目录 <code>make package</code>, 会生成一个 .dmg 文件，自带安装包。但是接近开发完成再去运行这个命令就报错无法执行了。</p> <p>根据官方的 <code>.travis.yml</code> 文件可以构建出一个直接运行的 .app 文件。其中的命令可以简化为：</p> <div class="language- extra-class"><pre class="language-text"><code>./CI/install-dependencies-osx.sh &amp;&amp; ./CI/before-script-osx.sh &amp;&amp; cd ./build &amp;&amp; make -j4 &amp;&amp; cd - &amp;&amp; ./CI/before-deploy-osx.sh
</code></pre></div><p>但是官方的 Qt 版本之类可能和本地都不同，需要自己对脚本进行一些修改。</p> <p>我的 Mac 比较神奇，命令行运行时无法获取到 Qt 的 include 目录，可能是安装时运行的不完全吧。需要在自己命令行的 bash_rc 文件中导入如下变量：</p> <div class="language- extra-class"><pre class="language-text"><code>export C_INCLUDE_PATH=&quot;/usr/local/include:/usr/local/Cellar/qt/5.13.1/include&quot;
export CPLUS_INCLUDE_PATH=&quot;/usr/local/include:/usr/local/Cellar/qt/5.13.1/include&quot;
export LIBRARY_PATH=&quot;/usr/local/include:/usr/local/Cellar/qt/5.13.1/include&quot;
</code></pre></div><p>执行了上述的 Shell 命令后会两次要求输入密码，之后即可编译成功，在 build 目录下出现 .app 文件。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2019/10/12 下午5:53:01</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.cea302cc.js" defer></script><script src="/assets/js/3.19db34b2.js" defer></script><script src="/assets/js/1.4d56c206.js" defer></script><script src="/assets/js/14.618c3df5.js" defer></script>
  </body>
</html>
